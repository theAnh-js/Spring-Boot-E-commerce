var buttonLoadForState;
var dropDownCountryForState;
var dropDownState;

var buttonAddState;
var buttonUpdateState;
var buttonDeleteState;
var labelStateName;
var fieldStateName; 

$(document).ready(function(){
	buttonLoadForState = $("#buttonLoadCountriesForState");
	dropDownCountryForState = $("#dropDownCountriesForState");
	dropDownState = $("#dropDownStates");
	
	buttonAddState = $("#buttonAddState");
	buttonUpdateState = $("buttonUpdateState");
	buttonDeleteState = $("#buttonDeleteState");
	labelStateName = $("#labelStateName");
	fieldStateName = $("#fieldStateName");	
	
	buttonLoadForState.click(function(){
		loadCountriesForState();
	});
	
	dropDownCountryForState.on("change", function(){
		loadStateForCountry();
	});
	
	dropDownState.on("change", function(){
		changeFormStateToSelectedState();
	});
	
	buttonAddState.click(function(){
		if(buttonAddState.val() == "Add"){
			addState();
		}else{
			changeFormStateToNew();
		}
	});
	
});

function loadStateForCountry(){
	selectedCountry = $("#dropDownCountriesForState option:selected");
	countryId = selectedCountry.val();
	//countryId = dropDownCountryForState.val().split("-")[0];
	
	url = contextPath + "states/list_by_country/" + countryId;
	
	$.get(url, function(responseJSON){
		dropDownState.empty();
		
		$.each(responseJSON, function(index, state){			
			optionValue = state.id;
			$("<option>").val(optionValue).text(state.name).appendTo(dropDownState);
		});
	}).done(function(){
		changeFormStateToNew();
		showToastMessage("All States have been loaded for country " + selectedCountry.text());
	}).fail(function(){
		showToastMessage("ERROR: Could not connect to server or server encountered an error")
	});
		
}

function loadCountriesForState(){
	url = contextPath + "countries/list";
	
	$.get(url, function(responseJSON){
		dropDownCountryForState.empty();
		dropDownState.empty();
		
		$.each(responseJSON, function(index, country){	
			optionValue = country.id + "-" + country.code;
			$("<option>").val(optionValue).text(country.name).appendTo(dropDownCountryForState);
		});
	}).done(function(){
		buttonLoadForState.val("Refresh Country List");
		showToastMessage("All countries have been load");
	}).fail(function(){
		showToastMessage("ERROR: Could not connect to server or server encountered an error")
	});
	
}

function changeFormStateToNew(){
	buttonAddState.val("Add");
	labelStateName.text("State/Province Name: ")
}

function showToastMessage(message){
	$("#toastMessage").text(message);
	$(".toast").toast('show');
}